<!DOCTYPE html>
<head>
    <title>Slot Machine</title>
    <link rel="stylesheet" type="text/css" href="css/browser_reset.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<html>
<body>
<main>
	<div class="status" id="status">SPIN TO WIN!</div>
	<div class="slots">
		<div id="slot1" class="a1"></div>
		<div id="slot2" class="a1"></div>
		<div id="slot3" class="a1"></div>
    </div>
	<button type="submit" value="Submit" class="button"  onclick="return gamble(y)" style="vertical-align:middle"><span>SPIN</span></button>
   
<div class="chip-container">
	<input type="image" src="images/blackjack/overig/10-chip.png" onCLick="addbet(10)" class="pokerchip" alt="10 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/25-chip.png" onCLick="addbet(25)" class="pokerchip" alt="25 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/50-chip.png" onCLick="addbet(50)" class="pokerchip" alt="50 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/100-chip.png" onCLick="addbet(100)" class="pokerchip" alt="100 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/200-chip.png" onCLick="addbet(200)" class="pokerchip" alt="200 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/500-chip.png" onCLick="addbet(500)" class="pokerchip" alt="500 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/1000-chip.png" onCLick="addbet(1000)" class="pokerchip" alt="1000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/2000-chip.png" onCLick="addbet(2000)" class="pokerchip" alt="2000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/10000-chip.png" onCLick="addbet(10000)" class="pokerchip" alt="10000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/50000-chip.png" onCLick="addbet(50000)" class="pokerchip" alt="50000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/100000-chip.png" onCLick="addbet(100000)" class="pokerchip" alt="100000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/500000-chip.png" onCLick="addbet(500000)" class="pokerchip" alt="500000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/1mil-chip.png" onCLick="addbet(1000000)" class="pokerchip" alt="1000000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/10mil-chip.png" onCLick="addbet(10000000)" class="pokerchip" alt="10000000 poker chip" width="150" height=auto>
	<input type="image" src="images/blackjack/overig/allin-chip.png" onclick="addbet('allin')" class="pokerchip" alt="All in poker chip" width="150" height="auto">
</div>

<div class="status">
<table>
	<tr>
		<td id="message1">Money: $0</td>
		<td id="message2">Now Betting: $0</td>
    </tr>
	</table>
</div>
</main>


<script>

	var action = false;
let status = document.getElementById("status");

// coins uit localStorage laden of start op 0
var coins = Number(localStorage.getItem("coins")) || 0;
var y = 0; // huidige inzet

// initial display
document.getElementById("message1").innerHTML = "Money: $" + coins;
document.getElementById("message2").innerHTML = "Now Betting: $0";

// functie om chips toe te voegen
function addbet(amount){
    // check of het de all-in chip is
    if(amount === "allin"){
        if(coins <= 0){
            status.innerHTML = "You have no coins!";
            return;
        }
        y = coins; // alles inzetten
        document.getElementById("message2").innerHTML = "Now Betting: $" + y;
        status.innerHTML = "All in!";
        return;
    }

    // normale chips
    if (y + amount > coins) {
        status.innerHTML = "Not enough funds.";
        return;
    }

    y += amount;
    document.getElementById("message2").innerHTML = "Now Betting: $" + y;
    status.innerHTML = "Bet placed.";
}

// spin functie (oude logica behouden)
function gamble(y){
    if (action) return;

    if (y <= 0) {
        status.innerHTML = "Place a bet first!";
        return;
    }

    if (y > coins) {
        status.innerHTML = "Not enough funds.";
        y = 0;
        document.getElementById("message2").innerHTML = "Now Betting: $0";
        return;
    }

    action = true;

    var numChanges = randomInt(1,4)*7;
    var numberSlot1 = numChanges + randomInt(1,7);
    var numberSlot2 = numChanges + 2*7 + randomInt(1,7);
    var numberSlot3 = numChanges + 4*7 + randomInt(1,7);

    var i1 = 0;
    var i2 = 0;
    var i3 = 0;

    status.innerHTML = "SPINNING";

    slot1 = setInterval(spin1, 50);
    slot2 = setInterval(spin2, 50);
    slot3 = setInterval(spin3, 50);

    function spin1(){
        i1++;
        if (i1 >= numberSlot1){
            clearInterval(slot1);
            return null;
        }
        let slotTile = document.getElementById("slot1");
        if (slotTile.className == "a7") slotTile.className = "a0";
        slotTile.className = "a" + (parseInt(slotTile.className.substring(1)) + 1);
    }

    function spin2(){
        i2++;
        if (i2 >= numberSlot2){
            clearInterval(slot2);
            return null;
        }
        let slotTile = document.getElementById("slot2");
        if (slotTile.className == "a7") slotTile.className = "a0";
        slotTile.className = "a" + (parseInt(slotTile.className.substring(1)) + 1);
    }

    function spin3(){
        i3++;
        if (i3 >= numberSlot3){
            clearInterval(slot3);
            testWin();
            return null;
        }
        let slotTile = document.getElementById("slot3");
        if (slotTile.className == "a7") slotTile.className = "a0";
        slotTile.className = "a" + (parseInt(slotTile.className.substring(1)) + 1);
    }
}

// win / lose logica met nieuwe uitbetalingen
function testWin(){
    var slot1 = document.getElementById("slot1").className;
    var slot2 = document.getElementById("slot2").className;
    var slot3 = document.getElementById("slot3").className;

    let payout = 0; // hoeveel je wint

    // mapping van symbool naar multiplier
    const multipliers2 = {
        "a3": 2, // strawberry
        "a6": 2, // star
        "a2": 3, // cherry
        "a5": 3, // clover
        "a4": 4, // diamond
        "a7": 4, // crown
        "a1": 5  // seven
    };

    const multipliers3 = {
        "a3": 6,
        "a6": 6,
        "a2": 7,
        "a5": 7,
        "a4": 8,
        "a7": 8,
        "a1": 10
    };

    // teller van hoeveel dezelfde symbolen
    const symbols = [slot1, slot2, slot3];
    const counts = {};
    symbols.forEach(s => counts[s] = (counts[s] || 0) + 1);

    // check voor 3 dezelfde
    for(let sym in counts){
        if(counts[sym] === 3){
            payout = y * (multipliers3[sym] || 0);
            break;
        }
    }

    // check voor 2 dezelfde (als 3 dezelfde al was, wordt dit niet meer uitgevoerd)
    if(payout === 0){
        for(let sym in counts){
            if(counts[sym] === 2){
                payout = y * (multipliers2[sym] || 0);
                break;
            }
        }
    }

    // win of verlies
    if(payout > 0){
        status.innerHTML = "YOU WIN! +" + payout + " coins";
        coins += payout;
    } else {
        status.innerHTML = "YOU LOSE!";
        coins -= y;
        if(coins < 0) coins = 0;
    }

    y = 0; // inzet reset
    document.getElementById("message1").innerHTML = "Money: $" + coins;
    document.getElementById("message2").innerHTML = "Now Betting: $0";

    // localStorage bijwerken
    localStorage.setItem("coins", coins);

    action = false;
}

// helper functie
function randomInt(min, max){
    return Math.floor((Math.random() * (max-min+1)) + min);
}

</script>



</body>
</html>